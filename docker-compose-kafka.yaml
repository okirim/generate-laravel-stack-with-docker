version: '2'
services:

  broker:
    image: confluentinc/confluent-local:7.4.1
    hostname: broker
    container_name: broker
    ports:
      - "9092:9092"
      - "9093:9093"

    environment:
      KAFKA_LISTENERS: >
        PLAINTEXT://broker:29092,
        CONTROLLER://broker:29093,
        PLAINTEXT_HOST://0.0.0.0:9092,
        SSL_HOST://0.0.0.0:9093

      KAFKA_ADVERTISED_LISTENERS: >
        PLAINTEXT://broker:29092,
        PLAINTEXT_HOST://localhost:9092,
        SSL_HOST://localhost:9093

      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: >
        PLAINTEXT:PLAINTEXT,
        PLAINTEXT_HOST:PLAINTEXT,
        SSL_HOST:SASL_SSL,
        CONTROLLER:PLAINTEXT

      KAFKA_CONTROLLER_QUORUM_VOTERS: '1@broker:29093'

      # TLS auto x
      KAFKA_SSL_KEYSTORE_TYPE: PEM
      KAFKA_SSL_TRUSTSTORE_TYPE: PEM
      KAFKA_SSL_CLIENT_AUTH: none
      KAFKA_SSL_ENDPOINT_IDENTIFICATION_ALGORITHM: ""

      # ðŸ”¥ SASL PLAIN
      KAFKA_SASL_ENABLED_MECHANISMS: PLAIN
      KAFKA_SASL_MECHANISM_INTER_BROKER_PROTOCOL: PLAIN
      KAFKA_LISTENER_NAME_SSL_HOST_SASL_ENABLED_MECHANISMS: PLAIN
      KAFKA_LISTENER_NAME_SSL_HOST_PLAIN_SASL_JAAS_CONFIG: >
        org.apache.kafka.common.security.plain.PlainLoginModule required
        username="admin"
        password="admin-secret"
        user_admin="admin-secret";
